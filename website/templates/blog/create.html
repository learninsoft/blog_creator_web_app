{% extends 'base/base.html' %}
{% block head_block %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/create.css') }}">

    <!-- Include the Quill library -->
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="{{ url_for('static', filename='js/create_editor.js') }}"></script>
{% endblock %}
{% block content %}
{#<form method="post">#}
    <div class="body"><br>
      <div class="container-fluid">
        <div class="row">
          <div class="col-12 col-sm-6 col-md-6">
              <div class="form-group">
                <label for="title">Enter your Title</label>
                <input type="text" class="form-control" id="title" name="title"/>
              </div>
              <div class="form-group">
                <label for="category">category</label>
                <input type="text" class="form-control" id="category" name="category"/>
              </div>
{#            </form>#}
          </div>
        </div>
        <div class="editor">
          <div id="editor">
            <p>Hello Blogger!</p>
            <p>Had <strong>Your</strong> Brunch?</p>
            <p><br /></p>
          </div>
        </div>

        <div class="form-group">
          <label for="ref">Reference</label>
          <textarea class="form-control" id="ref" rows="1" name="references"></textarea>
        </div>
        <div class="toggle">
          <p><strong> INDEX off/on</strong></p>
          <label class="switch">
            <input type="checkbox" checked name="is_active" />
            <span class="slider round"></span>
          </label>
        </div>
        <div>
          <label for="">Generate Link</label>
          <select id="type" name="slug_options" onchange="generate_link(this.value)">
            <option selected></option>
            <option value="auto">auto</option>
            <option value="manual">manual</option>
          </select>
          <input type="text" class="form-control" name="slug" id="slug" oninput="slug_changed(this.value)"/>
        </div>
        <br />
        <button type="submit" class="btn btn-outline-secondary" onclick="submitForm()">create</button>
      </div>
    </div>
{#    </form>#}
<!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="{{ url_for('static', filename='js/create_editor.js') }}"></script>

    <script type="text/javascript">

        function generate_link(value) {
            const current_slug_value = document.getElementById('slug').value;
            if (!current_slug_value){
                if (value === "auto"){
                console.log(value);
                document.getElementById('slug').value = "value" + value
                }
                else if(value === "manual"){
                    console.log("value of manual: "+value)
                }
            }

        }

        function slug_changed(value) {
            console.log("value of slug: "+value)

        }

        function submitForm(){
            console.log("Button clicked.")
            body = document.getElementById('editor').innerHTML
            title = document.getElementById('title').value
            slug = document.getElementById('slug').value
            category = document.getElementById('category').value

            formData = {'body': body, 'title': title, 'slug': slug, 'category': category}
            $.ajax({
                url: '{{ url_for('blogs.create_post') }}',
                type: "POST",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(formData),
                dataType: "json",
                success: function (data) {
                    console.log(typeof data);
                    console.log(data);
                    if (data['link_exists']){
                        alert(data['message'])
                    } else {
                        window.location.href = data['redirect_to']
                    }
                },
                error: function (error) {
                    console.log(`Error ${error}`);
                    console.log(JSON.stringify(error))
                 }
             });
        }
    </script>
{% endblock %}
