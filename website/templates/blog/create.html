{% extends 'base/base.html' %}
{% block head_block %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/create.css') }}">
    <link
            href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
            rel="stylesheet"
    />
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="{{ url_for('static', filename='js/create_editor.js') }}"></script>
{% endblock %}
{% block content %}
    {#<form method="post">#}
    {#create page it has some input text fields and a editor#}
    <div class="body"><br>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-sm-6 col-md-6">
                    <div class="form-group">
                        <label for="title">Enter your Title *</label>
                        <input type="text" class="form-control" id="title" name="title" placeholder="Enter your Title"/>
                    </div>
                    <div class="form-group">
                        <label for="category">category *</label>
                        <input type="text" class="form-control" id="category" name="category" placeholder="#category"/>
                    </div>
                    {#            </form>#}
                </div>
            </div>
            <div class="editor">
                <div id="editor">
                    <p>Hello Blogger!</p>
                    <p>Had <strong>Your</strong> Brunch?</p>
                    <p><br/></p>
                </div>
            </div>
            <div class="form-group">
                <label for="ref">Reference</label>
                <textarea class="form-control" id="ref" rows="1" name="references"></textarea>
            </div>
            {#toggle for private post of blog#}
            <div class="toggle">
                <p><strong> INDEX off/on</strong></p>
                <label class="switch">
                    <input type="checkbox" checked name="is_active" id="index_type"/>
                    <span class="slider round"></span>
                </label>
            </div>
            <div>
                {#link genrator for blogs with auto and manual#}
                <label for="">Generate Link</label>
                <select id="type" name="slug_options" onchange="hide_visible().generate_link(this.value)">
                    <option value="1">manual</option>
                    <option value="2">auto</option>
                </select>
                <div id="input">
                    <input type="text" class="form-control" name="slug" id="slug" oninput="slug_changed(this.value)"/>
                </div>
            </div>
            <br/>
            {#create button#}
            <button type="submit" class="btn btn-danger" onclick="submitForm()">create</button>
        </div>
        <br>
    </div>
    {#    </form>#}
    <!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="{{ url_for('static', filename='js/create_editor.js') }}"></script>

    <script type="text/javascript">

        function generate_link(value) {
            const current_slug_value = document.getElementById('slug').value;
            if (!current_slug_value) {
                if (value === "auto") {
                    console.log(value);
                    document.getElementById('slug').value = "value" + value
                } else if (value === "manual") {
                    console.log("value of manual: " + value)
                }
            }

        }

        function hide_visible() {
            var place = document.getElementById("type");
            if (place.value == 2) {
                document.getElementById("input").style.visibility = "hidden";
            } else {
                document.getElementById("input").style.visibility = "visible";
            }
        }

        function slug_changed(value) {
            console.log("value of slug: " + value)

        }

        function validate_inputs() {
            var is_valid = true
            var edit = document.getElementById('editor').innerHTML
            var titlev = document.getElementById('title').value
            if (titlev.length < 3 || title.length > 25) {
                alert("min of 3 and max of 25 character for title");
                is_valid = false
            }
            var slugv = document.getElementById('slug').value
            if (slugv.length > 30) {
                alert("max of 30 character for link");
                is_valid = false
            }
            var categoryv = document.getElementById('category').value
            if (categoryv.length < 3 || category.length > 30) {
                alert("min of 3 and max of 30 character for category");
                is_valid = false
            }
            return is_valid

        }

        function submitForm() {
            if (!validate_inputs()) {
                console.log("No valid inputs provided.")
                return null
            }
            console.log("Button clicked.")
            body = document.getElementById('editor').innerHTML
            title = document.getElementById('title').value
            slug = document.getElementById('slug').value
            category = document.getElementById('category').value
            var slug_type = document.getElementById("type").value
            var index_rdo = document.getElementById('index_type').checked;

            formData = {
                'body': body, 'title': title, 'slug': slug, 'category': category,
                'slug_type': slug_type, 'is_active': index_rdo
            }
            $.ajax({
                url: '{{ url_for('blogs.create_post') }}',
                type: "POST",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(formData),
                dataType: "json",
                success: function (data) {
                    console.log(typeof data);
                    console.log(data);
                    if (data['link_exists']) {
                        alert(data['message'])
                    } else {
                        window.location.href = data['redirect_to']
                    }
                },
                error: function (error) {
                    console.log(`Error ${error}`);
                    console.log(JSON.stringify(error))
                }
            });
        }
    </script>
{% endblock %}
